{"version":3,"sources":["../../../../lib/storage.ts","../../../../app/actions/items.ts","../../../../.next-internal/server/app/items/new/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["import { writeFile, unlink } from \"fs/promises\";\nimport { join } from \"path\";\n\nexport async function uploadImage(file: File): Promise<string> {\n  // Generate unique filename\n  const fileExt = file.name.split(\".\").pop();\n  const fileName = `${Math.random().toString(36).substring(2)}-${Date.now()}.${fileExt}`;\n\n  // Convert File to Buffer\n  const bytes = await file.arrayBuffer();\n  const buffer = Buffer.from(bytes);\n\n  // Save to public/uploads directory\n  const uploadsDir = join(process.cwd(), \"public\", \"uploads\");\n  const filePath = join(uploadsDir, fileName);\n\n  await writeFile(filePath, buffer);\n\n  // Return relative URL\n  return `/uploads/${fileName}`;\n}\n\nexport async function deleteImage(imageUrl: string): Promise<void> {\n  try {\n    // Extract filename from URL\n    const fileName = imageUrl.split(\"/\").pop();\n    if (!fileName) return;\n\n    // Delete from public/uploads directory\n    const filePath = join(process.cwd(), \"public\", \"uploads\", fileName);\n    await unlink(filePath);\n  } catch (error) {\n    console.error(\"Failed to delete image:\", error);\n  }\n}\n","\"use server\";\n\nimport prisma from \"@/lib/prisma\";\nimport { requireAuth } from \"@/lib/auth\";\nimport { revalidatePath } from \"next/cache\";\nimport { Category, ItemStatus } from \"@prisma/client\";\nimport { uploadImage, deleteImage } from \"@/lib/storage\";\n\nexport async function uploadItemImage(formData: FormData) {\n  try {\n    const file = formData.get(\"file\") as File;\n    if (!file) {\n      return { success: false, error: \"No file provided\" };\n    }\n\n    const imageUrl = await uploadImage(file);\n    return { success: true, imageUrl };\n  } catch (error) {\n    console.error(\"Error uploading image:\", error);\n    return { success: false, error: \"Failed to upload image\" };\n  }\n}\n\nexport async function createItem(formData: FormData) {\n  const user = await requireAuth();\n\n  const title = formData.get(\"title\") as string;\n  const description = formData.get(\"description\") as string;\n  const category = formData.get(\"category\") as Category;\n  const location = formData.get(\"location\") as string;\n  const contactNumber = formData.get(\"contactNumber\") as string;\n  const status = formData.get(\"status\") as ItemStatus;\n  const imageUrl = formData.get(\"imageUrl\") as string;\n\n  try {\n    const item = await prisma.item.create({\n      data: {\n        title,\n        description,\n        category,\n        location,\n        contactNumber,\n        status,\n        imageUrl,\n        userId: user.id,\n      },\n    });\n\n    revalidatePath(\"/\");\n    revalidatePath(\"/dashboard\");\n    return { success: true, item };\n  } catch (error) {\n    console.error(\"Error creating item:\", error);\n    return { success: false, error: \"Failed to create item\" };\n  }\n}\n\nexport async function updateItem(itemId: string, formData: FormData) {\n  const user = await requireAuth();\n\n  const item = await prisma.item.findUnique({\n    where: { id: itemId },\n  });\n\n  if (!item) {\n    return { success: false, error: \"Item not found\" };\n  }\n\n  // Check if user owns the item or is admin\n  if (item.userId !== user.id && user.role !== \"ADMIN\") {\n    return { success: false, error: \"Unauthorized\" };\n  }\n\n  const title = formData.get(\"title\") as string;\n  const description = formData.get(\"description\") as string;\n  const category = formData.get(\"category\") as Category;\n  const location = formData.get(\"location\") as string;\n  const contactNumber = formData.get(\"contactNumber\") as string;\n  const status = formData.get(\"status\") as ItemStatus;\n  const imageUrl = formData.get(\"imageUrl\") as string | null;\n\n  try {\n    const updatedItem = await prisma.item.update({\n      where: { id: itemId },\n      data: {\n        title,\n        description,\n        category,\n        location,\n        contactNumber,\n        status,\n        ...(imageUrl && { imageUrl }),\n      },\n    });\n\n    revalidatePath(\"/\");\n    revalidatePath(\"/dashboard\");\n    revalidatePath(`/items/${itemId}`);\n    return { success: true, item: updatedItem };\n  } catch (error) {\n    console.error(\"Error updating item:\", error);\n    return { success: false, error: \"Failed to update item\" };\n  }\n}\n\nexport async function deleteItem(itemId: string) {\n  const user = await requireAuth();\n\n  const item = await prisma.item.findUnique({\n    where: { id: itemId },\n  });\n\n  if (!item) {\n    return { success: false, error: \"Item not found\" };\n  }\n\n  // Check if user owns the item or is admin\n  if (item.userId !== user.id && user.role !== \"ADMIN\") {\n    return { success: false, error: \"Unauthorized\" };\n  }\n\n  try {\n    // Delete image if exists\n    if (item.imageUrl) {\n      await deleteImage(item.imageUrl);\n    }\n\n    await prisma.item.delete({\n      where: { id: itemId },\n    });\n\n    revalidatePath(\"/\");\n    revalidatePath(\"/dashboard\");\n    return { success: true };\n  } catch (error) {\n    console.error(\"Error deleting item:\", error);\n    return { success: false, error: \"Failed to delete item\" };\n  }\n}\n\nexport async function markItemAsResolved(itemId: string, resolved: boolean) {\n  const user = await requireAuth();\n\n  const item = await prisma.item.findUnique({\n    where: { id: itemId },\n  });\n\n  if (!item) {\n    return { success: false, error: \"Item not found\" };\n  }\n\n  // Check if user owns the item or is admin\n  if (item.userId !== user.id && user.role !== \"ADMIN\") {\n    return { success: false, error: \"Unauthorized\" };\n  }\n\n  try {\n    const updatedItem = await prisma.item.update({\n      where: { id: itemId },\n      data: { isResolved: resolved },\n    });\n\n    revalidatePath(\"/\");\n    revalidatePath(\"/dashboard\");\n    revalidatePath(`/items/${itemId}`);\n    return { success: true, item: updatedItem };\n  } catch (error) {\n    console.error(\"Error updating item:\", error);\n    return { success: false, error: \"Failed to update item\" };\n  }\n}\n\nexport async function getItems(filters?: { search?: string; category?: Category; status?: ItemStatus; resolved?: boolean }) {\n  try {\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    const where: any = {};\n\n    if (filters?.search) {\n      where.OR = [{ title: { contains: filters.search, mode: \"insensitive\" } }, { description: { contains: filters.search, mode: \"insensitive\" } }, { location: { contains: filters.search, mode: \"insensitive\" } }];\n    }\n\n    if (filters?.category) {\n      where.category = filters.category;\n    }\n\n    if (filters?.status) {\n      where.status = filters.status;\n    }\n\n    if (filters?.resolved !== undefined) {\n      where.isResolved = filters.resolved;\n    }\n\n    const items = await prisma.item.findMany({\n      where,\n      include: {\n        user: {\n          select: {\n            name: true,\n            email: true,\n          },\n        },\n      },\n      orderBy: {\n        createdAt: \"desc\",\n      },\n    });\n\n    return items;\n  } catch (error) {\n    console.error(\"Error fetching items:\", error);\n    return [];\n  }\n}\n\nexport async function getItemById(itemId: string) {\n  try {\n    const item = await prisma.item.findUnique({\n      where: { id: itemId },\n      include: {\n        user: {\n          select: {\n            name: true,\n            email: true,\n          },\n        },\n      },\n    });\n\n    return item;\n  } catch (error) {\n    console.error(\"Error fetching item:\", error);\n    return null;\n  }\n}\n\nexport async function getUserItems() {\n  const user = await requireAuth();\n\n  try {\n    const items = await prisma.item.findMany({\n      where: { userId: user.id },\n      orderBy: { createdAt: \"desc\" },\n    });\n\n    return items;\n  } catch (error) {\n    console.error(\"Error fetching user items:\", error);\n    return [];\n  }\n}\n","export {signOut as '00ff1d0b6e750f2af6d32139b707e387ab1a6be8d4'} from 'ACTIONS_MODULE0'\nexport {createItem as '40480d4fe3378d5fb9b0509d427236f2961f84c373'} from 'ACTIONS_MODULE1'\nexport {updateItem as '6000bd970759369a83502178400bb7db088ec2701e'} from 'ACTIONS_MODULE1'\nexport {uploadItemImage as '40cc05ffd1fafb7fb7bb076d159eed5029d7dee660'} from 'ACTIONS_MODULE1'\n"],"names":[],"mappings":"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"}