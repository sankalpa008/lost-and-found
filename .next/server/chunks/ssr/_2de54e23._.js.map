{"version":3,"sources":["../../../../app/actions/admin.ts","../../../../.next-internal/server/app/admin/users/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["\"use server\";\n\nimport prisma from \"@/lib/prisma\";\nimport { requireAdmin } from \"@/lib/auth\";\nimport { revalidatePath } from \"next/cache\";\nimport { hashPassword } from \"@/lib/auth\";\n\nexport async function getAllUsers() {\n  await requireAdmin();\n\n  try {\n    const users = await prisma.user.findMany({\n      orderBy: { createdAt: \"desc\" },\n      include: {\n        _count: {\n          select: { items: true },\n        },\n      },\n    });\n\n    return users;\n  } catch (error) {\n    console.error(\"Error fetching users:\", error);\n    return [];\n  }\n}\n\nexport async function deleteUser(userId: string) {\n  await requireAdmin();\n\n  try {\n    const user = await prisma.user.findUnique({\n      where: { id: userId },\n    });\n\n    if (!user) {\n      return { success: false, error: \"User not found\" };\n    }\n\n    // Delete user and cascade delete sessions and items\n    await prisma.user.delete({\n      where: { id: userId },\n    });\n\n    revalidatePath(\"/admin/users\");\n    return { success: true };\n  } catch (error) {\n    console.error(\"Error deleting user:\", error);\n    return { success: false, error: \"Failed to delete user\" };\n  }\n}\n\nexport async function createAdminUser(email: string, password: string, name?: string) {\n  await requireAdmin();\n\n  try {\n    // Check if user already exists\n    const existingUser = await prisma.user.findUnique({\n      where: { email },\n    });\n\n    if (existingUser) {\n      return { success: false, error: \"User with this email already exists\" };\n    }\n\n    // Hash password\n    const hashedPassword = await hashPassword(password);\n\n    // Create user in Prisma with ADMIN role\n    await prisma.user.create({\n      data: {\n        email,\n        password: hashedPassword,\n        name,\n        role: \"ADMIN\",\n      },\n    });\n\n    revalidatePath(\"/admin/users\");\n    return { success: true };\n  } catch (error: unknown) {\n    console.error(\"Error creating admin user:\", error);\n    const errorMessage = error instanceof Error ? error.message : \"Failed to create user\";\n    return { success: false, error: errorMessage };\n  }\n}\n\nexport async function createStudentUser(email: string, password: string, name?: string) {\n  await requireAdmin();\n\n  try {\n    // Check if user already exists\n    const existingUser = await prisma.user.findUnique({\n      where: { email },\n    });\n\n    if (existingUser) {\n      return { success: false, error: \"User with this email already exists\" };\n    }\n\n    // Hash password\n    const hashedPassword = await hashPassword(password);\n\n    // Create user in Prisma with STUDENT role\n    await prisma.user.create({\n      data: {\n        email,\n        password: hashedPassword,\n        name,\n        role: \"STUDENT\",\n      },\n    });\n\n    revalidatePath(\"/admin/users\");\n    return { success: true };\n  } catch (error: unknown) {\n    console.error(\"Error creating student user:\", error);\n    const errorMessage = error instanceof Error ? error.message : \"Failed to create user\";\n    return { success: false, error: errorMessage };\n  }\n}\n","export {getAllUsers as '0017f7986cc16dea30f6f1f8172cfbd97e7efaa604'} from 'ACTIONS_MODULE0'\nexport {deleteUser as '40901afc44bc2e63c4c4d91d21e1c8a37aa778052c'} from 'ACTIONS_MODULE0'\nexport {createStudentUser as '702156816a9106d86bc3d4dc013b326a8dd14a003b'} from 'ACTIONS_MODULE0'\nexport {createAdminUser as '709af9d15934fda82e752e145449fd84e7a54102ea'} from 'ACTIONS_MODULE0'\nexport {signOut as '00ff1d0b6e750f2af6d32139b707e387ab1a6be8d4'} from 'ACTIONS_MODULE1'\nexport {deleteUser as '40901afc44bc2e63c4c4d91d21e1c8a37aa778052c'} from 'ACTIONS_MODULE0'\nexport {createStudentUser as '702156816a9106d86bc3d4dc013b326a8dd14a003b'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":"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"}