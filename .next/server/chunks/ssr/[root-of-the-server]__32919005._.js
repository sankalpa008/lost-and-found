module.exports=[24868,(a,b,c)=>{b.exports=a.x("fs/promises",()=>require("fs/promises"))},76864,a=>{"use strict";var b=a.i(24868),c=a.i(14747);async function d(a){let d=a.name.split(".").pop(),e=`${Math.random().toString(36).substring(2)}-${Date.now()}.${d}`,f=await a.arrayBuffer(),g=Buffer.from(f),h=(0,c.join)(process.cwd(),"public","uploads"),i=(0,c.join)(h,e);return await (0,b.writeFile)(i,g),`/uploads/${e}`}async function e(a){try{let d=a.split("/").pop();if(!d)return;let e=(0,c.join)(process.cwd(),"public","uploads",d);await (0,b.unlink)(e)}catch(a){console.error("Failed to delete image:",a)}}a.s(["deleteImage",()=>e,"uploadImage",()=>d])},18060,a=>a.a(async(b,c)=>{try{var d=a.i(37936),e=a.i(31191),f=a.i(9223),g=a.i(18558),h=a.i(76864),i=a.i(13095),j=b([e,f]);async function k(a){try{let b=a.get("file");if(!b)return{success:!1,error:"No file provided"};let c=await (0,h.uploadImage)(b);return{success:!0,imageUrl:c}}catch(a){return console.error("Error uploading image:",a),{success:!1,error:"Failed to upload image"}}}async function l(a){let b=await (0,f.requireAuth)(),c=a.get("title"),d=a.get("description"),h=a.get("category"),i=a.get("location"),j=a.get("contactNumber"),k=a.get("status"),l=a.get("imageUrl");try{let a=await e.default.item.create({data:{title:c,description:d,category:h,location:i,contactNumber:j,status:k,imageUrl:l,userId:b.id}});return(0,g.revalidatePath)("/"),(0,g.revalidatePath)("/dashboard"),{success:!0,item:a}}catch(a){return console.error("Error creating item:",a),{success:!1,error:"Failed to create item"}}}async function m(a,b){let c=await (0,f.requireAuth)(),d=await e.default.item.findUnique({where:{id:a}});if(!d)return{success:!1,error:"Item not found"};if(d.userId!==c.id&&"ADMIN"!==c.role)return{success:!1,error:"Unauthorized"};let h=b.get("title"),i=b.get("description"),j=b.get("category"),k=b.get("location"),l=b.get("contactNumber"),m=b.get("status"),n=b.get("imageUrl");try{let b=await e.default.item.update({where:{id:a},data:{title:h,description:i,category:j,location:k,contactNumber:l,status:m,...n&&{imageUrl:n}}});return(0,g.revalidatePath)("/"),(0,g.revalidatePath)("/dashboard"),(0,g.revalidatePath)(`/items/${a}`),{success:!0,item:b}}catch(a){return console.error("Error updating item:",a),{success:!1,error:"Failed to update item"}}}async function n(a){let b=await (0,f.requireAuth)(),c=await e.default.item.findUnique({where:{id:a}});if(!c)return{success:!1,error:"Item not found"};if(c.userId!==b.id&&"ADMIN"!==b.role)return{success:!1,error:"Unauthorized"};try{return c.imageUrl&&await (0,h.deleteImage)(c.imageUrl),await e.default.item.delete({where:{id:a}}),(0,g.revalidatePath)("/"),(0,g.revalidatePath)("/dashboard"),{success:!0}}catch(a){return console.error("Error deleting item:",a),{success:!1,error:"Failed to delete item"}}}async function o(a,b){let c=await (0,f.requireAuth)(),d=await e.default.item.findUnique({where:{id:a}});if(!d)return{success:!1,error:"Item not found"};if(d.userId!==c.id&&"ADMIN"!==c.role)return{success:!1,error:"Unauthorized"};try{let c=await e.default.item.update({where:{id:a},data:{isResolved:b}});return(0,g.revalidatePath)("/"),(0,g.revalidatePath)("/dashboard"),(0,g.revalidatePath)(`/items/${a}`),{success:!0,item:c}}catch(a){return console.error("Error updating item:",a),{success:!1,error:"Failed to update item"}}}async function p(a){try{let b={};return a?.search&&(b.OR=[{title:{contains:a.search,mode:"insensitive"}},{description:{contains:a.search,mode:"insensitive"}},{location:{contains:a.search,mode:"insensitive"}}]),a?.category&&(b.category=a.category),a?.status&&(b.status=a.status),a?.resolved!==void 0&&(b.isResolved=a.resolved),await e.default.item.findMany({where:b,include:{user:{select:{name:!0,email:!0}}},orderBy:{createdAt:"desc"}})}catch(a){return console.error("Error fetching items:",a),[]}}async function q(a){try{return await e.default.item.findUnique({where:{id:a},include:{user:{select:{name:!0,email:!0}}}})}catch(a){return console.error("Error fetching item:",a),null}}async function r(){let a=await (0,f.requireAuth)();try{return await e.default.item.findMany({where:{userId:a.id},orderBy:{createdAt:"desc"}})}catch(a){return console.error("Error fetching user items:",a),[]}}[e,f]=j.then?(await j)():j,(0,i.ensureServerEntryExports)([k,l,m,n,o,p,q,r]),(0,d.registerServerReference)(k,"40cc05ffd1fafb7fb7bb076d159eed5029d7dee660",null),(0,d.registerServerReference)(l,"40480d4fe3378d5fb9b0509d427236f2961f84c373",null),(0,d.registerServerReference)(m,"6000bd970759369a83502178400bb7db088ec2701e",null),(0,d.registerServerReference)(n,"40c0892441c8f7e694a5ac071d6853cedfedd85b11",null),(0,d.registerServerReference)(o,"60166baca848cc1b1810d945dfb6f495c794ed7901",null),(0,d.registerServerReference)(p,"407d90f5259c3db6827890960254580b905c49102a",null),(0,d.registerServerReference)(q,"4034adc90bcac4fd6171dcbb417a2d6eef69737e8e",null),(0,d.registerServerReference)(r,"003e3850756fef8b1063c93c62586ac1df889638ce",null),a.s(["createItem",()=>l,"deleteItem",()=>n,"getItemById",()=>q,"getItems",()=>p,"getUserItems",()=>r,"markItemAsResolved",()=>o,"updateItem",()=>m,"uploadItemImage",()=>k]),c()}catch(a){c(a)}},!1),20006,a=>a.a(async(b,c)=>{try{var d=a.i(37936),e=a.i(31191),f=a.i(9223),g=a.i(18558),h=a.i(13095),i=b([e,f]);async function j(){await (0,f.requireAdmin)();try{return await e.default.user.findMany({orderBy:{createdAt:"desc"},include:{_count:{select:{items:!0}}}})}catch(a){return console.error("Error fetching users:",a),[]}}async function k(a){await (0,f.requireAdmin)();try{if(!await e.default.user.findUnique({where:{id:a}}))return{success:!1,error:"User not found"};return await e.default.user.delete({where:{id:a}}),(0,g.revalidatePath)("/admin/users"),{success:!0}}catch(a){return console.error("Error deleting user:",a),{success:!1,error:"Failed to delete user"}}}async function l(a,b,c){await (0,f.requireAdmin)();try{if(await e.default.user.findUnique({where:{email:a}}))return{success:!1,error:"User with this email already exists"};let d=await (0,f.hashPassword)(b);return await e.default.user.create({data:{email:a,password:d,name:c,role:"ADMIN"}}),(0,g.revalidatePath)("/admin/users"),{success:!0}}catch(b){console.error("Error creating admin user:",b);let a=b instanceof Error?b.message:"Failed to create user";return{success:!1,error:a}}}async function m(a,b,c){await (0,f.requireAdmin)();try{if(await e.default.user.findUnique({where:{email:a}}))return{success:!1,error:"User with this email already exists"};let d=await (0,f.hashPassword)(b);return await e.default.user.create({data:{email:a,password:d,name:c,role:"STUDENT"}}),(0,g.revalidatePath)("/admin/users"),{success:!0}}catch(b){console.error("Error creating student user:",b);let a=b instanceof Error?b.message:"Failed to create user";return{success:!1,error:a}}}[e,f]=i.then?(await i)():i,(0,h.ensureServerEntryExports)([j,k,l,m]),(0,d.registerServerReference)(j,"0017f7986cc16dea30f6f1f8172cfbd97e7efaa604",null),(0,d.registerServerReference)(k,"40901afc44bc2e63c4c4d91d21e1c8a37aa778052c",null),(0,d.registerServerReference)(l,"709af9d15934fda82e752e145449fd84e7a54102ea",null),(0,d.registerServerReference)(m,"702156816a9106d86bc3d4dc013b326a8dd14a003b",null),a.s(["createAdminUser",()=>l,"createStudentUser",()=>m,"deleteUser",()=>k,"getAllUsers",()=>j]),c()}catch(a){c(a)}},!1),54746,a=>a.a(async(b,c)=>{try{var d=a.i(20006),e=a.i(18060),f=a.i(77728),g=b([d,e,f]);[d,e,f]=g.then?(await g)():g,a.s([]),c()}catch(a){c(a)}},!1),84534,a=>a.a(async(b,c)=>{try{var d=a.i(54746),e=a.i(20006),f=a.i(18060),g=a.i(77728),h=b([d,e,f,g]);[d,e,f,g]=h.then?(await h)():h,a.s(["0017f7986cc16dea30f6f1f8172cfbd97e7efaa604",()=>e.getAllUsers,"003e3850756fef8b1063c93c62586ac1df889638ce",()=>f.getUserItems,"00ff1d0b6e750f2af6d32139b707e387ab1a6be8d4",()=>g.signOut,"4034adc90bcac4fd6171dcbb417a2d6eef69737e8e",()=>f.getItemById,"40480d4fe3378d5fb9b0509d427236f2961f84c373",()=>f.createItem,"407d90f5259c3db6827890960254580b905c49102a",()=>f.getItems,"40901afc44bc2e63c4c4d91d21e1c8a37aa778052c",()=>e.deleteUser,"40c0892441c8f7e694a5ac071d6853cedfedd85b11",()=>f.deleteItem,"40cc05ffd1fafb7fb7bb076d159eed5029d7dee660",()=>f.uploadItemImage,"6000bd970759369a83502178400bb7db088ec2701e",()=>f.updateItem,"60166baca848cc1b1810d945dfb6f495c794ed7901",()=>f.markItemAsResolved,"702156816a9106d86bc3d4dc013b326a8dd14a003b",()=>e.createStudentUser,"709af9d15934fda82e752e145449fd84e7a54102ea",()=>e.createAdminUser]),c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__32919005._.js.map